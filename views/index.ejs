<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>半年日記</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-stone-50 min-h-screen flex flex-col md:flex-row">
    <!-- サイドバー -->
    <aside class="w-full md:w-64 bg-slate-200 text-stone-200 p-6 flex-shrink-0">
      <h2
        class="text-xl font-bold mb-6 border-b border-stone-600 pb-2 italic text-stone-400"
      >
        Memory Log
      </h2>
      <nav>
        <ul class="space-y-1">
          <li>
            <a
              href="/"
              class="block p-3 rounded-lg hover:bg-stone-300 transition <%= !selectedMonth ? 'bg-stone-700 text-white font-bold' : 'border-2 border-stone-300 text-gray-700 font-bold' %>"
            >
              すべて表示
            </a>
          </li>
          <% months.forEach(month => { %>
          <li>
            <a
              href="/?month=<%= month.m %>"
              class="block p-3 rounded-lg hover:bg-stone-300 transition <%= selectedMonth === month.m ? 'bg-stone-700 text-white font-bold' : 'border-2 border-stone-300 text-gray-700 font-bold' %>"
            >
              <%= month.m %>
            </a>
          </li>
          <% }) %>
        </ul>
      </nav>
    </aside>

    <!-- メイン -->
    <main class="flex-1 p-6 md:p-12">
      <div class="max-w-2xl mx-auto">
        <header class="mb-10 text-center">
          <h1 class="text-4xl font-mono font-bold text-stone-800">
            <%= selectedMonth ? selectedMonth : '今日の日記' %>
          </h1>
          <p class="text-stone-400 mt-2 text-sm">
            ※保存（★）しない日記は、半年経つと消えます
          </p>
        </header>

        <!-- 投稿フォーム -->
        <section
          class="mb-12 bg-white p-6 rounded-2xl shadow-sm border border-stone-200"
        >
          <form action="/add" method="POST">
            <textarea
              name="content"
              rows="4"
              placeholder="日記を書く✏️"
              required
              class="w-full p-2 border-none focus:ring-0 text-lg resize-none outline-none text-stone-700"
            ></textarea>
            <button
              type="submit"
              class="w-full bg-stone-800 text-white py-3 rounded-xl hover:bg-stone-700 transition font-bold shadow-md"
            >
              完了
            </button>
          </form>
        </section>

        <!-- 日記リスト -->
        <div class="space-y-6">
          <% diaries.forEach(diary => { %>
          <article
            class="bg-white p-6 rounded-2xl shadow-sm border-l-4 transition-all <%= diary.is_marked ? 'border-amber-400 shadow-md' : 'border-stone-200' %>"
          >
            <div id="display-<%= diary.id %>">
              <p
                class="text-stone-800 whitespace-pre-wrap leading-relaxed text-lg mb-6"
              >
                <%= diary.content %>
              </p>
              <div class="flex justify-between items-center text-xs">
                <span class="text-stone-400 font-mono"
                  ><%= diary.created_at %></span
                >
                <div class="flex gap-4 items-center">
                  <form action="/mark/<%= diary.id %>" method="POST">
                    <button
                      type="submit"
                      class="<%= diary.is_marked ? 'text-amber-500 font-bold' : 'text-stone-300' %> hover:text-amber-600 transition text-sm"
                    >
                      <%= diary.is_marked ? '★ 保存済み' : '☆ 保存する' %>
                    </button>
                  </form>
                  <button
                    onclick="toggleEdit('<%= diary.id %>')"
                    class="text-stone-300 hover:text-blue-500 transition text-sm"
                  >
                    編集
                  </button>
                  <form
                    action="/delete/<%= diary.id %>"
                    method="POST"
                    onsubmit="return confirm('削除しますか？')"
                  >
                    <button
                      type="submit"
                      class="text-stone-300 hover:text-red-400 transition text-sm"
                    >
                      削除
                    </button>
                  </form>
                </div>
              </div>
            </div>

            <!-- 編集フォーム -->
            <form
              id="edit-form-<%= diary.id %>"
              action="/edit/<%= diary.id %>"
              method="POST"
              class="hidden"
            >
              <textarea
                name="content"
                class="w-full p-4 border border-stone-100 rounded-xl mb-3 focus:ring-1 focus:ring-stone-300 outline-none text-stone-700"
              >
<%= diary.content %></textarea
              >
              <div class="flex gap-2">
                <button
                  type="submit"
                  class="bg-stone-800 text-white px-4 py-1 rounded-lg text-sm"
                >
                  更新
                </button>
                <button
                  type="button"
                  onclick="toggleEdit('<%= diary.id %>')"
                  class="bg-stone-100 text-stone-500 px-4 py-1 rounded-lg text-sm text-center"
                >
                  戻る
                </button>
              </div>
            </form>
          </article>
          <% }) %> <% if (diaries.length === 0) { %>
          <div class="text-center py-20 text-stone-300 italic font-serif">
            No records found.
          </div>
          <% } %>
        </div>
      </div>
    </main>

    <script>
      function toggleEdit(id) {
        document.getElementById(`display-${id}`).classList.toggle("hidden");
        document.getElementById(`edit-form-${id}`).classList.toggle("hidden");
      }
    </script>
  </body>
</html>
